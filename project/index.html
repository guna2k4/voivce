<!DOCTYPE html>
<html lang="ta">
  <head>
    <meta charset="UTF-8" />
    <title>Tamil Voice  Schemes </title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Link to external CSS -->
    <link rel="stylesheet" href="styles.css" />

    <!-- React & Babel -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  </head>

  <body>
    <div id="root"></div>

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script type="text/babel">
      const SAMBANOVA_KEY = "b83fd8b0-19ea-4af6-bb47-16587ceb3c0a";

      function VoiceChat() {
        const [userText, setUserText] = React.useState("");
        const [aiResponse, setAiResponse] = React.useState("ЁЯдЦ AI рокродро┐ро▓рпН роХро╛родрпНродро┐ро░рпБроХрпНроХро┐ро▒родрпБ...");
        const [isRecording, setIsRecording] = React.useState(false);
        const [recordingText, setRecordingText] = React.useState("");

        // Sends the input text to the API and sets the AI response.
        const handleTextSubmit = async (text) => {
          const query = text || userText;
          if (!query.trim()) return;
          setAiResponse("тП│ рокродро┐ро▓рпИ рокрпЖро▒ роорпБропро▒рпНроЪро┐роХрпНроХро┐ро▒родрпБ...");
          const result = await fetch("https://api.sambanova.ai/v1/chat/completions", {
            method: "POST",
            headers: {
              Authorization: `Bearer ${SAMBANOVA_KEY}`,
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              stream: false,
              model: "DeepSeek-V3-0324",
              messages: [
                {
                  role: "system",
                  content:
                    "роирпАроЩрпНроХро│рпН родрооро┐ро┤рпН роЙродро╡ро┐ропро╛ро│ро░рпН. роОрокрпНрокрпЛродрпБроорпН родрооро┐ро┤ро┐ро▓рпН роороЯрпНроЯрпБроорпН рокродро┐ро▓ро│ро┐роХрпНроХро╡рпБроорпН. роОроирпНрод роЪро┐ро▒рокрпНрокрпБ роОро┤рпБродрпНродрпБроХрпНроХро│рпБроорпН рокропройрпНрокроЯрпБродрпНрод ро╡рпЗрогрпНроЯро╛роорпН. рокродро┐ро▓рпН роОро│ро┐роорпИропро╛роХро╡рпБроорпН, роЪрпБро░рпБроХрпНроХрооро╛роХро╡рпБроорпН роЗро░рпБроХрпНроХ ро╡рпЗрогрпНроЯрпБроорпН. рокрпЗроЪрпНроЪрпБ роорпКро┤ро┐ропро┐ро▓рпН рокродро┐ро▓ро│ро┐роХрпНроХро╡рпБроорпН.",
                },
                { role: "user", content: query },
              ],
            }),
          });
          const data = await result.json();
          if (data.choices && data.choices.length > 0) {
            const responseText = data.choices[0].message.content
              .replace(/[^\u0B80-\u0BFF\s]/g, "")
              .trim();
            setAiResponse("ЁЯдЦ AI рокродро┐ро▓рпН: " + responseText);
            speakTamil(responseText);
          } else {
            setAiResponse("тЭМ рокродро┐ро▓рпИ рокрпЖро▒ роорпБроЯро┐ропро╡ро┐ро▓рпНро▓рпИ.");
          }
        };

        // Uses speechSynthesis to speak the AI response.
        const speakTamil = (text) => {
          if ("speechSynthesis" in window) {
            const voices = window.speechSynthesis.getVoices();
            const tamilVoice = voices.find((v) => v.lang.includes("ta"));
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = "ta-IN";
            utterance.voice = tamilVoice || null;
            utterance.rate = 1;
            window.speechSynthesis.cancel();
            window.speechSynthesis.speak(utterance);
          } else {
            alert("роЙроЩрпНроХро│рпН роЙро▓ро╛ро╡ро┐ропро┐ро▓рпН роЙро░рпИ рокрпЗроЪрпБроорпН ро╡роЪродро┐ роЗро▓рпНро▓рпИ.");
          }
        };

        // Starts speech recognition which automatically stops when speech finishes.
        const startVoiceRecognition = () => {
          const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
          if (!SpeechRecognition) {
            alert("роЙроЩрпНроХро│рпН роЙро▓ро╛ро╡ро┐ Speech Recognition-роР роЖродро░ро┐роХрпНроХро╡ро┐ро▓рпНро▓рпИ.");
            return;
          }
          setIsRecording(true);
          setRecordingText("ЁЯОд рокродро┐ро╡рпБ роироЯрпИрокрпЖро▒рпБроХро┐ро▒родрпБ...");

          const recognition = new SpeechRecognition();
          recognition.lang = "ta-IN";
          recognition.interimResults = false;
          recognition.maxAlternatives = 1;
          recognition.continuous = false;  // Auto-stops after speech finishes

          recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript;
            setUserText(transcript);
            handleTextSubmit(transcript); // Auto-send to AI after speech ends
          };

          recognition.onerror = (event) => {
            setAiResponse("тЭМ роЙро░рпИропрпИ роЕроЯрпИропро╛ро│роорпН роХро╛рог роЗропро▓ро╡ро┐ро▓рпНро▓рпИ.");
            console.error("Speech recognition error:", event.error);
          };

          recognition.onend = () => {
            setIsRecording(false);
            setRecordingText("");
          };

          recognition.start();
        };

        return (
          <div className="voice-chat">
            <h1>ЁЯЧгя╕П родрооро┐ро┤рпН Sambanova роЙродро╡ро┐</h1>
            <input
              type="text"
              placeholder="роЙроЩрпНроХро│рпН роХрпЗро│рпНро╡ро┐ропрпИ роЙро│рпНро│ро┐роЯро╡рпБроорпН"
              value={userText}
              onChange={(e) => setUserText(e.target.value)}
            />
            <div className="button-group">
              <button onClick={() => handleTextSubmit()}>ЁЯУЭ рокродро┐ро▓рпН рокрпЖро▒</button>
              <button onClick={startVoiceRecognition} disabled={isRecording}>
                ЁЯОЩя╕П рокродро┐ро╡рпБ роЪрпЖропрпН
              </button>
            </div>
            {recordingText && <div className="recording-text">{recordingText}</div>}
            <div className="response-box">
              <p>{aiResponse}</p>
            </div>
          </div>
        );
      }

      function SchemeGrid() {
        const schemes = [
          { name: "рокроЪрпБроорпИ родро┐роЯрпНроЯроорпН", image: "images/green.jpg" },
          { name: "роЕро░роЪрпБ ро╡рпЗро▓рпИро╡ро╛ропрпНрокрпНрокрпБ", image: "images/job.jpg" },
          { name: "рооро░рпБродрпНродрпБро╡ роЙродро╡ро┐", image: "images/health.jpg" },
          { name: "рокрпЖрогрпНроХро│рпН рокро╛родрпБроХро╛рокрпНрокрпБ", image: "images/women.jpg" },
          { name: "роХро▓рпНро╡ро┐ роЙродро╡ро┐", image: "images/education.jpg" },
          { name: "ро╡ро┐ро╡роЪро╛роп роЙродро╡ро┐", image: "images/farming.jpg" },
        ];

        const handleClick = (schemeName) => {
          window.location.href = "home.html";
        };

        return (
          <div className="scheme-grid">
            <h1>ЁЯУЬ роЕро░роЪрпБ родро┐роЯрпНроЯроЩрпНроХро│рпН</h1>
            <div className="grid-container">
              {schemes.map((scheme, index) => (
                <div
                  key={index}
                  className="scheme-card"
                  onClick={() => handleClick(scheme.name)}
                >
                  <img src={scheme.image} alt={scheme.name} className="scheme-image" />
                  <div className="scheme-overlay">{scheme.name}</div>
                </div>
              ))}
            </div>
          </div>
        );
      }

      function App() {
        return (
          <div>
            <VoiceChat />
            <hr />
            <SchemeGrid />
          </div>
        );
      }

      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>
